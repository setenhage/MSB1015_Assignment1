<html>
<head>
<!-- Initialize a global WBK function -->
<script src="https://cdn.rawgit.com/maxlath/wikidata-sdk/dist/dist/wikibase-sdk.min.js"></script>
<!-- Initialize a global wdk object using the WBK object -->
<script src="https://cdn.rawgit.com/maxlath/wikidata-sdk/dist/dist/wikidata-sdk.min.js"></script>
</head>

<h1> Drugs targetting genes associated with Rheumatoid Arthritis </h1>
<p> MSB1015 Assignment 1 - Suzanne ten Hage </p>

<body>
  <pre id="output"></pre>
	
  <script>
	
    query = `SELECT ?drugLabel ?geneLabel ?diseaseLabel
  	WHERE {?disease wdt:P279* wd:Q187255. 	#Select Rheumatoid Arthritis as disease.
  	?disease  wdt:P2293 ?gene. 				#Select all genes associated with Rheumatoid Arthritis.
  	?gene wdt:P688 ?gene_product. 			#Find all gene products associated with those genes. 
  	?drug wdt:P129 ?gene_product. 			#Find all drugs targetting those gene products. 
	SERVICE wikibase:label { bd:serviceParam wikibase:language '[AUTO_LANGUAGE],en'. }
	}`
    
    fetch(
      wdk.sparqlQuery(query)
    ).then( response => response.json()
    ).then( wdk.simplify.sparqlResults
    ).then(
      function (response) {
     var html = "<table>";
    html += "<tr>";
    html += "<td>Gene</td>";
    html += "<td>Drug</td>";
    html += "</tr>";
    for(var i=0; i< response.length;i++) {
    html += "<tr>";
    html += "<td>"+response[i].geneLabel+"</td>";
    html += "<td>"+response[i].drugLabel+"</td>";
    html += "</tr>";
    }
    html += "</table>"
     document.getElementById('output').innerHTML = html;
      }
    )
  </script>
</body>
</html>
